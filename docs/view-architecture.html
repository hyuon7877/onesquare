<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneSquare ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1, h2 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .diagram-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .mermaid {
            text-align: center;
        }
        .nav {
            position: fixed;
            right: 20px;
            top: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav a {
            display: block;
            margin: 5px 0;
            color: #667eea;
            text-decoration: none;
        }
        .nav a:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#7c3aed',
                lineColor: '#5b21b6',
                secondaryColor: '#a78bfa',
                tertiaryColor: '#e9d5ff'
            }
        });
    </script>
</head>
<body>
    <div class="nav">
        <strong>ë¹ ë¥¸ ì´ë™</strong>
        <a href="#system">ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</a>
        <a href="#modules">ëª¨ë“ˆ ì˜ì¡´ì„±</a>
        <a href="#flow">ì‚¬ìš©ì í”Œë¡œìš°</a>
        <a href="#data">ë°ì´í„° í”Œë¡œìš°</a>
        <a href="#stats">í†µê³„</a>
        <a href="#layers">ë ˆì´ì–´ êµ¬ì¡°</a>
    </div>

    <h1>ğŸ—ï¸ OneSquare ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</h1>
    
    <div id="system" class="diagram-container">
        <h2>ğŸ“Š ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</h2>
        <div class="mermaid">
graph TB
    subgraph "Client Layer"
        PWA[PWA Frontend]
        Mobile[Mobile Web]
        Desktop[Desktop Web]
    end
    
    subgraph "Application Layer"
        Django[Django Server<br/>Port: 8500]
        ServiceWorker[Service Worker]
        Static[Static Files]
    end
    
    subgraph "Data Layer"
        SQLite[(SQLite DB)]
        NotionAPI[Notion API]
        Cache[IndexedDB Cache]
    end
    
    PWA --> ServiceWorker
    Mobile --> Django
    Desktop --> Django
    ServiceWorker --> Cache
    Django --> SQLite
    Django --> NotionAPI
    ServiceWorker --> Django
    Django --> Static
        </div>
    </div>

    <div id="modules" class="diagram-container">
        <h2>ğŸ”§ ëª¨ë“ˆ ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨</h2>
        <div class="mermaid">
graph LR
    subgraph Core["ğŸ”µ Core Modules"]
        Config[config/settings.py]
        URLs[config/urls.py]
        WSGI[config/wsgi.py]
        Secrets[secrets.json]
    end
    
    subgraph Auth["ğŸŸ¢ Authentication"]
        AuthSystem[auth_system]
        Decorators[decorators.py]
        CustomUser[CustomUser Model]
    end
    
    subgraph Features["ğŸŸ¡ Feature Modules"]
        Dashboard[dashboard]
        Calendar[calendar_system]
        FieldReports[field_reports]
        Revenue[revenue]
        Leave[leave_management]
        TimeTrack[time_tracking]
        Feedback[feedback]
        AI[ai_analytics]
        Monitor[monitoring]
    end
    
    subgraph Integration["ğŸŸ£ Integration"]
        Notion[notion_api]
        PWAModule[pwa]
        SW[Service Worker]
        Manifest[manifest.json]
    end
    
    Config --> URLs
    Config --> WSGI
    Secrets --> Config
    
    AuthSystem --> Config
    Decorators --> AuthSystem
    CustomUser --> AuthSystem
    
    Dashboard --> AuthSystem
    Dashboard --> Revenue
    Calendar --> AuthSystem
    Calendar --> Notion
    FieldReports --> AuthSystem
    Revenue --> AuthSystem
    Revenue --> Notion
    Leave --> AuthSystem
    Leave --> Calendar
    TimeTrack --> AuthSystem
    TimeTrack --> FieldReports
    Feedback --> AuthSystem
    AI --> Dashboard
    AI --> Revenue
    Monitor --> Config
    
    Notion --> Config
    PWAModule --> SW
    PWAModule --> Manifest
        </div>
    </div>

    <div id="flow" class="diagram-container">
        <h2>ğŸ¯ ê¸°ëŠ¥ë³„ ëª¨ë“ˆ ê´€ê³„ë„</h2>
        <div class="mermaid">
flowchart TD
    subgraph UserFlow["ğŸ‘¤ ì‚¬ìš©ì í”Œë¡œìš°"]
        Login[ë¡œê·¸ì¸]
        Auth{ì¸ì¦}
        Permission{ê¶Œí•œí™•ì¸}
        Access[ì ‘ê·¼í—ˆê°€]
    end
    
    subgraph AdminFlow["ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì ê¸°ëŠ¥"]
        AdminDash[ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ]
        Reports[ë¦¬í¬íŠ¸ ê´€ë¦¬]
        UserMgmt[ì‚¬ìš©ì ê´€ë¦¬]
        Analytics[ë°ì´í„° ë¶„ì„]
    end
    
    subgraph PartnerFlow["ğŸ¤ íŒŒíŠ¸ë„ˆ ê¸°ëŠ¥"]
        FieldApp[í˜„ì¥ ë¦¬í¬íŠ¸ ì•±]
        CheckList[ì²´í¬ë¦¬ìŠ¤íŠ¸]
        PhotoUpload[ì‚¬ì§„ ì—…ë¡œë“œ]
        TimeRecord[ì‹œê°„ ê¸°ë¡]
    end
    
    Login --> Auth
    Auth -->|ì„±ê³µ| Permission
    Auth -->|ì‹¤íŒ¨| Login
    Permission -->|ê´€ë¦¬ì| AdminFlow
    Permission -->|íŒŒíŠ¸ë„ˆ| PartnerFlow
    Permission -->|ì¼ë°˜| Access
    
    AdminDash --> Reports
    AdminDash --> UserMgmt
    AdminDash --> Analytics
    
    FieldApp --> CheckList
    FieldApp --> PhotoUpload
    FieldApp --> TimeRecord
        </div>
    </div>

    <div id="data" class="diagram-container">
        <h2>ğŸ”„ ë°ì´í„° í”Œë¡œìš°</h2>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant PWA
    participant Django
    participant SQLite
    participant Notion
    participant Cache
    
    User->>PWA: ìš”ì²­
    PWA->>Cache: ìºì‹œ í™•ì¸
    alt ìºì‹œ ìˆìŒ
        Cache-->>PWA: ìºì‹œ ë°ì´í„°
        PWA-->>User: ë¹ ë¥¸ ì‘ë‹µ
        PWA->>Django: ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸
    else ìºì‹œ ì—†ìŒ
        PWA->>Django: API ìš”ì²­
        Django->>SQLite: ë¡œì»¬ ë°ì´í„° ì¡°íšŒ
        Django->>Notion: Notion ë™ê¸°í™”
        Notion-->>Django: ë°ì´í„° ì‘ë‹µ
        Django-->>PWA: ì²˜ë¦¬ëœ ë°ì´í„°
        PWA->>Cache: ìºì‹œ ì €ì¥
        PWA-->>User: ì‘ë‹µ
    end
        </div>
    </div>

    <div id="stats" class="diagram-container">
        <h2>ğŸ“¦ ëª¨ë“ˆ ì¹´í…Œê³ ë¦¬ ë¶„í¬</h2>
        <div class="mermaid">
pie title ëª¨ë“ˆ ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬
    "Core Modules" : 4
    "Feature Modules" : 10
    "Utils Modules" : 4
    "Integration Modules" : 4
        </div>
    </div>

    <div id="layers" class="diagram-container">
        <h2>ğŸ—ï¸ ì‹œìŠ¤í…œ ë ˆì´ì–´ êµ¬ì¡°</h2>
        <div class="mermaid">
graph TD
    subgraph Presentation["ğŸ¨ Presentation Layer"]
        Templates[HTML Templates]
        StaticFiles[CSS/JS/Images]
        PWAAssets[PWA Assets]
    end
    
    subgraph Business["ğŸ’¼ Business Layer"]
        Views[Django Views]
        Serializers[Serializers]
        Services[Service Classes]
        Utils[Utility Functions]
    end
    
    subgraph Data["ğŸ’¾ Data Layer"]
        Models[Django Models]
        Migrations[Migrations]
        DBRouter[DB Router]
    end
    
    subgraph External["ğŸŒ External Services"]
        NotionDB[Notion Database]
        EmailService[Email Service]
        SMSService[SMS Service]
    end
    
    Templates --> Views
    StaticFiles --> Templates
    PWAAssets --> StaticFiles
    
    Views --> Services
    Views --> Serializers
    Services --> Utils
    
    Services --> Models
    Models --> Migrations
    Models --> DBRouter
    
    Services --> NotionDB
    Services --> EmailService
    Services --> SMSService
        </div>
    </div>

</body>
</html>